<!-- purchase/battelsConfirm.html -->
{% extends 'layout.html' %}

{% block title %}Pay for Tickets by Battels{% endblock %}

{% block content %}
    <section id="battelsConfirm" class="columns">
        <h3>Your Tickets</h3>
	<p>Only tickets with names are shown here. If you have unnamed tickets, you will need to set the names on the dashboard before you can pay for them.</p>
        {% if current_user.hasUnpaidTickets('Battels') %}
            <form action="{{ url_for('purchase.battelsConfirm') }}" method="post">
                <table id="ticketsTable">
                    <thead>
                        <tr>
                            <th>Select</th>
                            <th>Ticket Number</th>
                            <th>Name on Ticket</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ticket in current_user.tickets %}
                            {% if ticket.paymentmethod == 'Battels' and not ticket.paid and not ticket.cancelled and ticket.name != None %}
                                <tr id="ticket-{{ ticket.id }}">
                                    <td><input type="checkbox" name="tickets[]" id="ticketSelect-{{ ticket.id }}" value="{{ ticket.id }}" {% if tickets and ticket.id in tickets %}checked="checked" {% endif %}/></td>
                                    <td><label for="ticketSelect-{{ ticket.id }}">#{{ '%05d' % ticket.id }}</label></td>
                                    <td><label for="ticketSelect-{{ ticket.id }}">{{ ticket.name | default('Not Set') }}</label></td>
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
                {% if not current_user.canPayByBattels() %}
                    <p>You cannot currently pay by battels. Please <a href="{{ url_for('purchase.changeMethod') }}">change the payment method on your tickets.</a></p>
                {% else %}
                    {% if template_config['CURRENT_TERM'] == 'MT' %}
                        <button type="submit" class="small" name="paymentTerm" value="MT">
                            Pay all in Michaelmas
                        </button>
                        <button type="submit" class="small" name="paymentTerm" value="MTHT">
                            Pay half each in Michaelmas/Hilary
                        </button>
                    {% endif %}
                    <button type="submit" class="small" name="paymentTerm" value="HT">
                        Pay all in Hilary
                    </button>
                {% endif %}
            </form>
        {% else %}
            <p>You have no unpaid tickets marked as paying for by battels. Perhaps you'd like to <a href="{{ url_for('purchase.changeMethod') }}">change the payment method on some tickets</a> or <a href="{{ url_for('purchase.purchaseHome') }}">buy some more tickets</a>?</p>
        {% endif %}
    </section>
{% endblock %}
